# YAML Configuration Reference

> **AI-Generated Content Disclaimer**: This documentation has been generated by an AI assistant. While efforts have been made to ensure accuracy and completeness, please use this information with caution. Always verify critical information and consult with project maintainers for authoritative guidance.

This document provides a comprehensive reference for all available YAML configuration options in the CI Demo project.

## Table of Contents

- [Basic Structure](#basic-structure)
- [Job Configuration](#job-configuration)
- [Kubernetes Configuration](#kubernetes-configuration)
- [Registry Configuration](#registry-configuration)
- [Volume Configuration](#volume-configuration)
- [Environment Variables](#environment-variables)
- [Container Configuration](#container-configuration)
- [Steps Configuration](#steps-configuration)
- [Pipeline Configuration](#pipeline-configuration)
- [Init Stage Configuration](#init-stage-configuration)
- [Examples](#examples)

## Basic Structure

The basic structure of a CI Demo YAML configuration file follows this pattern:

```yaml
job: <job_name>
kubernetes:
  cloud: <cloud_name>
  # Additional kubernetes configuration

# Optional configurations
registry_host: <host>
registry_path: <path>
registry_auth: <auth>

volumes: # List of volume mounts
  - {mountPath: <path>, hostPath: <path>}

env: # Environment variables
  <key>: <value>

runs_on_dockers: # Container configurations
  - {name: <name>, url: <image_url>, category: <category>, arch: <arch>}

steps: # List of steps to execute
  - name: <step_name>
    # Step configuration

pipeline_start: # Pipeline start configuration
  run: <command>

pipeline_stop: # Pipeline stop configuration
  run: <command>
```

## Configuration Options Reference

### Job Configuration

The job configuration defines the basic properties of a CI/CD job, including its name, failure handling, and execution limits.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `job` | string | Yes | Name of the job | Any valid string |
| `failFast` | boolean | No | Whether to fail fast on errors | `true`, `false` (default: `false`) |
| `timeout` | string | No | Maximum execution time | Duration string (e.g., "1h", "30m", "2h30m") |
| `retry` | integer | No | Number of retry attempts | 0-5 (default: 0) |

#### YAML Example

```yaml
job: "build-and-test"
failFast: true
timeout: "2h"
retry: 2
```

### Kubernetes Configuration

The Kubernetes configuration defines how the job interacts with the Kubernetes cluster, including cloud provider settings, resource allocation, and scheduling preferences.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `cloud` | string | Yes | Cloud provider name | "aws", "gcp", "azure", "local" |
| `namespace` | string | No | Kubernetes namespace | Any valid namespace name |
| `serviceAccount` | string | No | Service account name | Any valid service account name |
| `nodeSelector` | object | No | Node selection criteria | Key-value pairs for node labels |
| `resources` | object | No | Resource requirements | CPU and memory specifications |
| `tolerations` | array | No | Node tolerations | List of toleration objects |

#### YAML Example

```yaml
kubernetes:
  cloud: "aws"
  namespace: "ci-demo"
  serviceAccount: "ci-service-account"
  nodeSelector:
    node-role.kubernetes.io/worker: "true"
  resources:
    requests:
      cpu: "1"
      memory: "2Gi"
    limits:
      cpu: "2"
      memory: "4Gi"
  tolerations:
    - key: "dedicated"
      operator: "Equal"
      value: "ci-worker"
      effect: "NoSchedule"
```

### Registry Configuration

The registry configuration defines how to interact with container registries, including authentication and path settings.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `registry_host` | string | No | Registry host URL | Valid URL (e.g., "docker.io", "gcr.io") |
| `registry_path` | string | No | Registry path | Valid path string |
| `registry_auth` | object | No | Authentication details | Username/password or token |

#### YAML Example

```yaml
registry_host: "docker.io"
registry_path: "myorg/ci-demo"
registry_auth:
  username: "${DOCKER_USERNAME}"
  password: "${DOCKER_PASSWORD}"
```

### Volume Configuration

Volume configuration defines how to mount storage into containers, including host paths, container paths, and access modes.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `mountPath` | string | Yes | Container mount path | Valid absolute path |
| `hostPath` | string | Yes | Host path | Valid absolute path |
| `readOnly` | boolean | No | Read-only mount | `true`, `false` (default: `false`) |
| `type` | string | No | Volume type | "emptyDir", "hostPath", "configMap", "secret" |

#### YAML Example

```yaml
volumes:
  - mountPath: "/workspace"
    hostPath: "/var/lib/jenkins/workspace"
    readOnly: false
  - mountPath: "/etc/config"
    hostPath: "/etc/ci-config"
    readOnly: true
    type: "configMap"
```

### Environment Variables

Environment variables configuration defines variables that will be available to all steps in the pipeline.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `key` | string | Yes | Variable name | Valid environment variable name |
| `value` | string | Yes | Variable value | Any string value |
| `secret` | boolean | No | Whether value is secret | `true`, `false` (default: `false`) |

#### YAML Example

```yaml
env:
  BUILD_NUMBER: "${BUILD_NUMBER}"
  GIT_COMMIT: "${GIT_COMMIT}"
  API_KEY:
    value: "${API_KEY}"
    secret: true
  DEBUG: "false"
```

### Container Configuration

Container configuration defines the containers that will be used for executing steps in the pipeline.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `name` | string | Yes | Container name | Any valid string |
| `url` | string | Yes | Image URL | Valid container image URL |
| `category` | string | No | Container category | "build", "test", "deploy" |
| `arch` | string | No | Architecture | "x86_64", "aarch64", "ppc64le" |
| `privileged` | boolean | No | Privileged mode | `true`, `false` (default: `false`) |
| `command` | array | No | Entrypoint command | Array of strings |
| `args` | array | No | Command arguments | Array of strings |

#### YAML Example

```yaml
runs_on_dockers:
  - name: "build-container"
    url: "docker.io/myorg/build-tools:latest"
    category: "build"
    arch: "x86_64"
    privileged: false
    command: ["/bin/bash"]
    args: ["-c", "make"]
  - name: "test-container"
    url: "docker.io/myorg/test-tools:latest"
    category: "test"
    arch: "x86_64"
```

### Steps Configuration

Steps configuration defines the individual actions that will be executed in the pipeline.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `name` | string | Yes | Step name | Any valid string |
| `run` | string | Yes | Command to execute | Shell command or script |
| `containerSelector` | string | No | Container selection | Container name or label |
| `shell` | string | No | Shell type | "bash", "sh", "powershell" |
| `module` | string | No | Module name | Any valid module name |
| `archiveArtifacts` | string | No | Artifact pattern | Glob pattern |
| `parallel` | boolean | No | Run in parallel | `true`, `false` (default: `false`) |
| `always` | string | No | Always run command | Shell command or script |
| `timeout` | string | No | Step timeout | Duration string |
| `retry` | integer | No | Retry attempts | 0-3 (default: 0) |

#### YAML Example

```yaml
steps:
  - name: "Build"
    run: |
      make clean
      make all
    containerSelector: "{name: 'build-container'}"
    shell: "bash"
    archiveArtifacts: "build/*.rpm"
    timeout: "30m"
    retry: 1

  - name: "Test"
    run: |
      ./test.sh
      ./coverage.sh
    containerSelector: "{name: 'test-container'}"
    parallel: true
    always: "echo 'Test completed'"
```

### Pipeline Configuration

Pipeline configuration defines the overall pipeline behavior, including start and stop actions.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `pipeline_start.run` | string | No | Start command | Shell command or script |
| `pipeline_stop.run` | string | No | Stop command | Shell command or script |
| `stages` | array | No | Pipeline stages | List of stage objects |
| `triggers` | array | No | Pipeline triggers | List of trigger objects |

#### YAML Example

```yaml
pipeline_start:
  run: |
    echo "Pipeline started at $(date)"
    mkdir -p artifacts

pipeline_stop:
  run: |
    echo "Pipeline completed at $(date)"
    ./cleanup.sh

stages:
  - name: "build"
    steps: ["build"]
  - name: "test"
    steps: ["test"]
  - name: "deploy"
    steps: ["deploy"]

triggers:
  - type: "git"
    branch: "main"
  - type: "schedule"
    cron: "0 0 * * *"
```

### Init Stage Configuration

The init stage configuration defines the initialization steps that run before the main pipeline execution.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `steps` | array | Yes | Init steps | List of step objects |
| `timeout` | string | No | Init timeout | Duration string |
| `retry` | integer | No | Retry attempts | 0-3 (default: 0) |

#### YAML Example

```yaml
init:
  steps:
    - name: "Setup Environment"
      run: |
        apt-get update
        apt-get install -y build-essential
        mkdir -p /workspace/build
        export BUILD_DIR=/workspace/build
    - name: "Configure Authentication"
      run: |
        echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        git config --global credential.helper store
  timeout: "10m"
  retry: 1
```

### Matrix Configuration

Matrix configuration defines how to run the same steps with different configurations.

#### Configuration Options

| Option | Type | Required | Description | Possible Values |
|--------|------|----------|-------------|----------------|
| `axes` | object | Yes | Matrix axes | Key-value pairs of arrays |
| `exclude` | array | No | Excluded combinations | List of combination objects |
| `include` | array | No | Additional combinations | List of combination objects |

#### YAML Example

```yaml
matrix:
  axes:
    cuda:
      - "dev/cuda9.2"
      - "dev/cuda10.0"
      - "dev/cuda11.0"
    arch:
      - "x86_64"
      - "aarch64"
    compiler:
      - "gcc"
      - "clang"
  exclude:
    - cuda: "dev/cuda11.0"
      arch: "aarch64"
  include:
    - cuda: "dev/cuda10.2"
      arch: "x86_64"
      compiler: "gcc"
      experimental: true
```

## Examples

The project provides several example YAML configurations to help you get started. These examples demonstrate different aspects of the CI/CD pipeline configuration:

1. **Matrix Testing Examples**
   - [Matrix with Actions](examples/job_matrix_actions.yaml) - Shows how to configure matrix testing with different actions
   - [Matrix with TAP](examples/job_matrix_tap.yaml) - Demonstrates matrix testing with TAP output
   - [Matrix with On-Fail Actions](examples/job_matrix_onfail.yaml) - Shows how to handle failures in matrix testing
   - [Matrix with Filters](examples/job_matrix_filters.yaml) - Demonstrates filtering in matrix testing
   - [Matrix with Environment Variables](examples/job_matrix_env.yaml) - Shows how to use environment variables in matrix testing

2. **Container Selection Examples**
   - [Container Selector](examples/job_matrix_containerSelector.yaml) - Shows how to select specific containers for jobs

3. **Agent Configuration Examples**
   - [Agents Only](examples/job_matrix_agents.yaml) - Basic agent configuration
   - [Agents and Kubernetes](examples/job_matrix_agents_and_k8.yaml) - Mix of agents and Kubernetes
   - [Agents and Kubernetes with Filters](examples/job_matrix_agents_and_k8_mix.yaml) - Advanced configuration with filters

These examples can be used as templates for your own configurations. Each example includes comments explaining the key configuration options used. 